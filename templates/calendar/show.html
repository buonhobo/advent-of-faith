<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Calendar: {{calendar.calendar.calendar.title}}</title>
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
          rel="stylesheet">
    <link href="/static/css/theme.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet">
    <style>
        /* --- GLOBAL FIXES --- */
        body, html {
            overflow-x: hidden; /* prevent horizontal glitch */
        }

        .wrap {
            padding-left: 1rem;
            padding-right: 1rem;
        }

        /* --- Calendar Header --- */
        .calendar-header-section .title {
            font-size: 3.5rem; /* large on desktop */
            font-weight: 800;
            text-align: center;
            color: #ffd7c2;
            text-shadow: 0 4px 16px rgba(255, 175, 140, 0.2);
            margin-bottom: 0.5rem;
        }

        .calendar-header-section .calendar-meta {
            font-size: 1.05rem;
            text-align: center;
            color: rgba(255, 217, 179, 0.85);
            font-style: italic;
            letter-spacing: 0.3px;
            margin: 0.15rem 0;
        }

        /* --- Days column --- */
        .days-row-wrapper {
            margin-top: 2rem;
            overflow: visible; /* shadows visible */
        }

        .days-column {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            align-items: center;
            padding: 2rem 0;
        }

        /* --- Day Cards --- */
        .day-card {
            width: 100%;
            max-width: 100%; /* remove desktop max-width for mobile */
            min-height: 140px;
            border-radius: 16px;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            padding: 1.5rem 1rem;
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--card-border);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            color: var(--ink);
            text-decoration: none;
        }

        .day-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 28px rgba(0,0,0,0.5);
            z-index: 2;
        }

        .day-number {
            font-family: 'Fraunces', serif;
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .day-label, .day-info {
            font-size: 0.75rem;
            color: var(--muted);
            text-align: center;
        }

        .day-details {
            position: absolute;
            bottom: 0.8rem;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            width: max-content;
        }

        /* Status colors */
        .day-future { background: rgba(255, 255, 255, 0.05); color: var(--muted); cursor: not-allowed; }
        .day-locked { background: rgba(215, 161, 89, 0.25); color: #ffd9b3; }
        .day-unlocked { background: rgba(215, 161, 89, 0.55); color: #2b1b12; font-weight: 600; }

        /* --- Add-Day Form --- */
        .add-day-form {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap; /* allow wrapping on mobile */
        }

        .add-day-form .form-control-romantic {
            flex: 1 1 200px;
            min-width: 100px;
        }

        .add-day-form .btn-honey {
            flex: 0 1 120px;
        }

    </style>
</head>
<body>
<div class="wrap py-5">
    <main class="main-content">
        <section class="calendar-header-section card-frost p-4 p-md-5">
            <h1 class="title mb-2">{{calendar.calendar.calendar.title}}</h1>
            <div class="calendar-meta">Created on {{ calendar.calendar.calendar.created_at.format("%b %d, %Y") }}</div>
            {% if let Some(date) = calendar.calendar.subscribed_at %}
            <div class="calendar-meta">Subscribed on {{ date.format("%b %d, %Y") }}</div>
            {% endif %}
        </section>

        <section class="days-row-wrapper mt-4">
            <div class="days-column">
                {% for user_day in calendar.days %}
                {% let status = user_day.get_status().as_str() %}
                {% if status == "future" %}
                <div class="day-card day-future">
                    <div class="day-number">{{ user_day.day.unlocks_at.format("%b %d %Y") }}</div>
                    <div class="day-details">
                        <div class="day-info">Available at {{ user_day.day.unlocks_at.format("%H:%M") }}</div>
                    </div>
                </div>
                {% elif status == "locked" %}
                <a href="/calendar/{{calendar.calendar.calendar.id}}/day/{{user_day.day.id}}" class="day-card day-locked">
                    <div class="day-number">{{ user_day.day.unlocks_at.format("%b %d %Y") }}</div>
                    <div class="day-details">
                        <div class="day-info">Available</div>
                    </div>
                </a>
                {% else %}
                <a href="/calendar/{{calendar.calendar.calendar.id}}/day/{{user_day.day.id}}" class="day-card day-unlocked">
                    <div class="day-number">{{ user_day.day.unlocks_at.format("%b %d %Y") }}</div>
                    <div class="day-details">
                        <div class="day-info">Unlocked on {{ user_day.unlocked_at.unwrap().format("%b %d %Y at %H:%M") }}</div>
                    </div>
                </a>
                {% endif %}
                {% endfor %}
            </div>
        </section>


        {% if user.id == calendar.calendar.calendar.owner_id %}
        <form action="/calendar/{{calendar.calendar.calendar.id}}/day/create"
              class="add-day-form mt-3 d-flex gap-2" id="add-day-form" method="post">
            <input class="form-control-romantic flex-grow-1" id="unlocks_at_input" placeholder="Select unlock date"
                   required type="text">
            <input id="unlocks_at" name="unlocks_at" type="hidden">
            <button class="btn btn-honey" type="submit">Add Day</button>
        </form>
        {% endif %}
    </main>
</div>
<footer class="container text-center pb-4">
    <small class="footer-note">Made with ðŸ’› by Alex</small>
</footer>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
    flatpickr("#unlocks_at_input", {
        enableTime: true,
        dateFormat: "Y-m-d H:i",
        time_24hr: true,
        onChange: function (selectedDates, dateStr) {
            if (selectedDates.length > 0) {
                document.getElementById('unlocks_at').value = selectedDates[0].toISOString();
            }
        }
    });
</script>
</body>
</html>
