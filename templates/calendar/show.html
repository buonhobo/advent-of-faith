<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Advent of Faith | {{user_calendar.calendar.title}}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/> <!-- âœ… important for mobile scaling -->

    <link
            crossorigin="anonymous"
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
            rel="stylesheet"
    />

    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link crossorigin href="https://fonts.gstatic.com" rel="preconnect">
    <link
            href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,400;9..144,600&family=Inter:wght@400;600&display=swap"
            rel="stylesheet"
    >

    <link href="/static/css/theme.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet">

    <style>
        /* --- GLOBAL FIXES --- */
        html, body {
            overflow-x: hidden;
            width: 100%;
            height: 100%;
            max-width: 100%;
            -webkit-text-size-adjust: 100%; /* âœ… prevents zoomed small text */
            background-attachment: fixed; /* âœ… helps prevent flicker on mobile */
        }

        /* Prevent iOS "white flash" artifacts due to fixed background + blur */
        body::before {
            transform: translateZ(0); /* âœ… hardware acceleration */
            will-change: transform, opacity;
            position: absolute; /* âœ… instead of fixed to reduce flickering */
        }

        .wrap {
            min-height: 100dvh;
            padding-left: 1rem;
            padding-right: 1rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        /* --- Calendar Header --- */
        .calendar-header-section .title {
            font-size: 3rem;
            font-weight: 800;
            text-align: center;
            color: #ffd7c2;
            text-shadow: 0 4px 16px rgba(255, 175, 140, 0.2);
            margin-bottom: 0.5rem;
            line-height: 1.1;
        }

        .calendar-header-section .calendar-meta {
            font-size: 1rem;
            text-align: center;
            color: rgba(255, 217, 179, 0.85);
            letter-spacing: 0.3px;
        }

        /* --- Days column --- */
        .days-row-wrapper {
            margin-top: 2rem;
            overflow: visible;
        }

        .days-column {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            align-items: center;
            padding: 2rem 0;
        }

        /* --- Day Cards --- */
        .day-card {
            width: 100%;
            min-height: 140px;
            border-radius: 16px;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            padding: 1.5rem 1rem;
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--card-border);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            color: var(--ink);
            text-decoration: none;
            will-change: transform; /* âœ… smoother hover animations on mobile */
        }

        .day-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 28px rgba(0, 0, 0, 0.5);
            z-index: 2;
        }

        .day-number {
            font-family: 'Fraunces', serif;
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
            word-break: break-word;
        }

        .day-label, .day-info {
            font-size: 0.8rem;
            color: var(--muted);
            text-align: center;
            line-height: 1.3;
        }

        .day-details {
            position: absolute;
            bottom: 0.8rem;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            width: max-content;
        }

        /* Status colors */
        .day-future {
            background: rgba(255, 255, 255, 0.05);
            color: var(--muted);
            cursor: not-allowed;
        }

        .day-locked {
            background: rgba(215, 161, 89, 0.25);
            color: #ffd9b3;
        }

        .day-unlocked {
            background: rgba(215, 161, 89, 0.55);
            color: #2b1b12;
            font-weight: 600;
        }

        /* --- Add-Day Form --- */
        .add-day-form {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .add-day-form .form-control-romantic {
            flex: 1 1 200px;
            min-width: 120px;
        }

        .add-day-form .btn-honey {
            flex: 0 1 120px;
        }

        /* --- Mobile improvements --- */
        @media (max-width: 576px) {
            .calendar-header-section .title {
                font-size: 2rem;
            }

            .calendar-header-section .calendar-meta {
                font-size: 0.9rem;
            }

            .days-column {
                padding: 1.5rem 0;
            }

            .day-card {
                min-height: 120px;
                padding: 1.2rem 0.8rem;
                border-radius: 12px;
            }

            .day-number {
                font-size: 1.6rem;
            }

            .day-label, .day-info {
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>
<div class="wrap">
    <main class="container-fluid px-3 py-5">
        <div class="main-content">
            <section class="calendar-header-section card-frost p-4 p-md-5">
                <h1 class="title mb-2">{{user_calendar.calendar.title}}</h1>
                <div class="calendar-meta">Created on {{ user_calendar.calendar.created_at.format("%b %d, %Y") }}</div>
                {% if let Some(date) = user_calendar.subscribed_at %}
                <div class="calendar-meta">Subscribed on {{ date.format("%b %d, %Y") }}</div>
                {% endif %}
            </section>

            <section class="days-row-wrapper mt-4">
                <div class="days-column">
                    {% for user_day in days %}
                    {% let status = user_day.get_status().as_str() %}
                    {% if status == "future" %}
                    <div class="day-card day-future">
                        <div class="day-number">{{ user_day.day.unlocks_at.format("%b %d %Y") }}</div>
                        <div class="day-details">
                            <div class="day-info">Available at {{ user_day.day.unlocks_at.format("%H:%M") }} UTC</div>
                        </div>
                    </div>
                    {% elif status == "locked" %}
                    <a class="day-card day-locked"
                       href="/calendar/{{user_calendar.calendar.id}}/day/{{user_day.day.id}}">
                        <div class="day-number">{{ user_day.day.unlocks_at.format("%b %d %Y") }}</div>
                        <div class="day-details">
                            <div class="day-info">Available</div>
                        </div>
                    </a>
                    {% else %}
                    <a class="day-card day-unlocked"
                       href="/calendar/{{user_calendar.calendar.id}}/day/{{user_day.day.id}}">
                        <div class="day-number">{{ user_day.day.unlocks_at.format("%b %d %Y") }}</div>
                        <div class="day-details">
                            <div class="day-info">Unlocked on {{ user_day.unlocked_at.unwrap().format("%b %d %Y at
                                %H:%M") }} UTC
                            </div>
                        </div>
                    </a>
                    {% endif %}
                    {% endfor %}
                </div>
            </section>

            {% if user.id == user_calendar.calendar.owner_id %}
            <form action="/calendar/{{user_calendar.calendar.id}}/day/create"
                  class="add-day-form" id="add-day-form" method="post">
                <input class="form-control-romantic" id="unlocks_at_input" placeholder="Select unlock date"
                       required type="text">
                <input
                        class="form-control form-control-romantic"
                        id="content"
                        name="content"
                        placeholder="Content"
                        required
                        type="text"
                />
                <input
                        class="form-control form-control-romantic"
                        id="password"
                        name="password"
                        placeholder="Password"
                        type="password"
                />
                <input id="unlocks_at" name="unlocks_at" type="hidden">
                <button class="btn btn-honey" type="submit">Add Day</button>
            </form>
            {% elif user_calendar.subscribed_at.is_none() %}
            <form action="/calendar/{{user_calendar.calendar.id}}/subscribe"
                  class="add-day-form" id="add-day-form" method="post">
                <button class="btn btn-honey" type="submit">Subscribe</button>
            </form>
            {% endif %}
            <a class="create-calendar-link" href="/home">Back to dashboard</a>
        </div>
    </main>
</div>

<footer class="container text-center pb-4">
    <small class="footer-note">Made with ðŸ’› by Alex</small>
</footer>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
    flatpickr("#unlocks_at_input", {
        enableTime: true,
        dateFormat: "Y-m-d H:i",
        time_24hr: true,
        onChange: function (selectedDates, dateStr) {
            if (selectedDates.length > 0) {
                document.getElementById('unlocks_at').value = selectedDates[0].toISOString();
            }
        }
    });
</script>
</body>
</html>
